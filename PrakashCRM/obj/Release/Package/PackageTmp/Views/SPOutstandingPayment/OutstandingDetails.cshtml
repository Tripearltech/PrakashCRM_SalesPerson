@model PrakashCRM.Data.Models.SPCustomerReport
@{
    ViewBag.Title = "OutstandingDetails";
    Layout = "~/Views/Shared/_SalespersonMasterLayout.cshtml";
}

<style>
    .clsPointer {
        cursor: pointer;
    }

    .toggle-icon {
        font-size: 18px;
        vertical-align: middle;
    }
</style>

<div class="page-content">
    <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
        <div class="ps-3">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0 p-0">
                    <li class="breadcrumb-item">
                        <a href="/SPDashboard/Index"><i class="bx bx-tachometer"></i>&nbsp;Dashboard</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">Outstanding Details</li>
                </ol>
            </nav>
        </div>
    </div>
    <hr />
    <div class="card">
        <div class="card-body">
            <table class="table mb-0 table-striped">
                <h2 style="text-align: center; color: darkblue;">
                    Prakash Chemicals Agencies Pvt. Ltd. - Name of Sales Executive
                </h2>

                <p><strong>Collection Report of 17/10/20</strong> <span style="color: green;">(System Date)</span></p>
                <p><strong>Collection upto 16/10/20</strong> <span style="color: blue;">(Workdate -1)</span></p>

                <thead>
                    <tr>
                        <th></th>
                        <th class="left-align">Name of Customer</th>
                        <th>Document No.</th>
                        <th>Over Days</th>
                        <th>Original Amount</th>
                        <th>Received Amount</th>
                        <th>Remaining Amount</th>
                        <th>ACD</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td></td>
                        <td class="left-align bold">Collection upto 16/10/2025 <span class="blue">(To Date)</span></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td>50000.00</td>
                        <td></td>
                        <td></td>
                    </tr>

                    <!-- ABC ENTERPRISE -->
                    <tr class="customer-row">
                        <td>
                            <a id="Branch1Rec" class="clsPointer" onclick="toggleDetails(this)">
                                <i class="bx bx-plus-circle"></i>
                            </a>
                        </td>
                        <td class="left-align">ABC ENTERPRISE</td>
                    </tr>
                    <tr class="toggle-detail" style="display: none;">
                        <td></td>
                        <td></td>
                        <td>PSIAD/2021/2333</td>
                        <td>10.00</td>
                        <td>30090.00</td>
                        <td>30090.00</td>
                        <td>0.00</td>
                        <td onmouseover="setCustomerTooltip(this)" onclick="openModal()">0</td>
                    </tr>
                    <tr class="toggle-detail" style="display: none;">
                        <td></td>
                        <td></td>
                        <td>PSIAD/2021/2343</td>
                        <td>5.00</td>
                        <td>15045.00</td>
                        <td>15045.00</td>
                        <td>0.00</td>
                        <td onmouseover="setCustomerTooltip(this)" onclick="openModal()">21</td>
                    </tr>
                    <tr class="total-row">
                        <td></td>
                        <td class="left-align">Total ABC ENTERPRISE</td>
                        <td colspan="2"></td>
                        <td>45135.00</td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>

                    <!-- ABC INDIA -->
                    <tr class="customer-row">
                        <td></td>
                        <td class="left-align">ABC INDIA</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td>PSIMI/2021/0121</td>
                        <td>25.00</td>
                        <td>1170560.00</td>
                        <td>170560.00</td>
                        <td>0.00</td>
                        <td onmouseover="setCustomerTooltip(this)" onclick="openModal()">1.00</td>
                    </tr>
                    <tr class="total-row">
                        <td></td>
                        <td class="left-align">Total ABC INDIA</td>
                        <td colspan="2"></td>
                        <td>170560.00</td>
                        <td>0.00</td>
                        <td></td>
                        <td></td>
                    </tr>

                    <!-- Final Totals -->
                    <tr class="total-row">
                        <td></td>
                        <td class="left-align">Total for the Period</td>
                        <td colspan="2"></td>
                        <td>215695.00</td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr class="total-row">
                        <td></td>
                        <td class="left-align">Collection upto 17/10/20</td>
                        <td colspan="2"></td>
                        <td>715695.00</td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
            <!-- Modal -->
            <div id="acdModal" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeModal()">&times;</span>
                    <h3>ACD Details</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Bill No</th>
                                <th>Posting Date</th>
                                <th>Amount</th>
                                <th>Due Date</th>
                                <th>Recd Date</th>
                                <th>Recd Amt</th>
                                <th>Recd Days * Recd Amt</th>
                                <th>Days</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>1</td><td>25-08-2020</td><td>1000</td><td>24-09-2020</td><td>25-09-2020</td><td>600</td><td>18600</td><td>31</td></tr>
                            <tr><td>1</td><td>25-08-2020</td><td>1000</td><td>24-09-2020</td><td>05-10-2020</td><td>400</td><td>16400</td><td>41</td></tr>
                            <tr><td>2</td><td>01-09-2020</td><td>5000</td><td>31-10-2020</td><td>02-11-2020</td><td>5000</td><td>310000</td><td>62</td></tr>
                            <tr><td>3</td><td>10-09-2020</td><td>3000</td><td>09-11-2020</td><td>22-11-2020</td><td>3000</td><td>219000</td><td>73</td></tr>
                            <tr><td>4</td><td>15-09-2020</td><td>4000</td><td>15-10-2020</td><td>15-10-2020</td><td>3000</td><td>90000</td><td>30</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@Scripts.Render("~/bundles/jquery")

<!-- JS -->
<script>
    function openModal() {
        document.getElementById('acdModal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('acdModal').style.display = 'none';
    }

    window.onclick = function (event) {
        const modal = document.getElementById('acdModal');
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    };

    function toggleDetails(element) {
        const icon = element.querySelector('i');
        const row = element.closest('tr');
        let next = row.nextElementSibling;
        const details = [];

        // collect all detail rows until total-row
        while (next && next.classList.contains('toggle-detail')) {
            details.push(next);
            next = next.nextElementSibling;
        }

        const isVisible = details.length && details[0].style.display !== 'none';
        details.forEach(r => r.style.display = isVisible ? 'none' : '');

        // switch icon dynamically
        icon.classList.remove(isVisible ? 'bx-minus-circle' : 'bx-plus-circle');
        icon.classList.add(isVisible ? 'bx-plus-circle' : 'bx-minus-circle');
    }


    function setCustomerTooltip(cell) {
        let currentRow = cell.closest('tr');
        while (currentRow && !currentRow.classList.contains('customer-row')) {
            currentRow = currentRow.previousElementSibling;
        }

        let customerName = '';
        if (currentRow) {
            customerName = currentRow.querySelector('td.left-align')?.textContent?.trim() || '';
        }

        cell.title = customerName;
    }
</script>