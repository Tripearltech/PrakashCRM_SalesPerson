@model PrakashCRM.Data.Models.SPCustomerReport
@{
    ViewBag.Title = "OutstandingDetails";
    Layout = "~/Views/Shared/_SalespersonMasterLayout.cshtml";
}
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">

<style>
    table {
        border-collapse: collapse;
        width: 100%;
        font-family: Arial, sans-serif;
    }

    th, td {
        border-top: 1px solid black;
        border-bottom: 1px solid black;
        border-left: none;
        border-right: none;
        padding: 3px;
        text-align: left;
    }

    th {
        background-color: yellow;
        font-weight: bold;
        color: red;
    }

    .header {
        font-weight: bold;
        text-align: left;
    }

    .blue {
        color: deepskyblue;
    }

    .bold {
        font-weight: bold;
    }

    .customer-row {
        background-color: #f2f2f2;
        font-weight: bold;
        text-align: left;
    }

    .total-row {
        font-weight: bold;
    }

    .left-align {
        text-align: left;
    }

    .clsPointer {
        cursor: pointer;
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
        background-color: #fff;
        margin: 50px auto;
        padding: 20px;
        width: 90%;
        max-width: 1200px;
        border-radius: 8px;
    }

    .close {
        color: red;
        float: right;
        font-size: 24px;
        font-weight: bold;
        cursor: pointer;
    }

        .close:hover {
            text-decoration: underline;
        }
</style>

<div class="page-content">
    <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
        <div class="ps-3">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0 p-0">
                    <li class="breadcrumb-item">
                        <a href="/SPDashboard/Index"><i class="bx bx-tachometer"></i>&nbsp;Dashboard</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">Outstanding Details</li>
                </ol>
            </nav>
        </div>
    </div>
    <hr />

    <p class="header">Collection Report of @DateTime.Now.ToString("dd/MM/yyyy") <span class="blue">(From Date)</span></p>
    <div class="card">
        <div class="card-body">
            <table>
                <thead>
                    <tr>
                        <th></th>
                        <th class="left-align">Name of Customer</th>
                        <th>Document No.</th>
                        <th>Over Days</th>
                        <th>Original Amount</th>
                        <th>Received Amount</th>
                        <th>Remaining Amount</th>
                        <th>ACD</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Example Data (You can replace with Razor loop using Model) -->
                    <tr>
                        <td></td>
                        <td class="left-align bold">Collection upto @(DateTime.Now.AddDays(-1).ToString("dd/MM/yyyy")) <span class="blue">(To Date)</span></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td>50000.00</td>
                        <td></td>
                        <td></td>
                    </tr>

                    <!-- Customer 1 -->
                    <tr class="customer-row">
                        <td>
                            <a class="clsPointer" onclick="toggleDetails(this)">
                                <i class="bx bx-plus-circle"></i>
                            </a>
                        </td>
                        <td class="left-align">ABC ENTERPRISE</td>
                    </tr>
                    <tr class="toggle-detail" style="display: none;">
                        <td></td>
                        <td></td>
                        <td>PSIAD/2021/2333</td>
                        <td>10.00</td>
                        <td>30090.00</td>
                        <td>30090.00</td>
                        <td>0.00</td>
                        <td onmouseover="setCustomerTooltip(this)" onclick="openModal()">0</td>
                    </tr>
                    <tr class="toggle-detail" style="display: none;">
                        <td></td>
                        <td></td>
                        <td>PSIAD/2021/2343</td>
                        <td>5.00</td>
                        <td>15045.00</td>
                        <td>15045.00</td>
                        <td>0.00</td>
                        <td onmouseover="setCustomerTooltip(this)" onclick="openModal()">21</td>
                    </tr>
                    <tr class="total-row">
                        <td></td>
                        <td class="left-align">Total ABC ENTERPRISE</td>
                        <td colspan="2"></td>
                        <td>45135.00</td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>

                    <!-- Customer 2 -->
                    <tr class="customer-row">
                        <td></td>
                        <td class="left-align">ABC INDIA</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td>PSIMI/2021/0121</td>
                        <td>25.00</td>
                        <td>1170560.00</td>
                        <td>170560.00</td>
                        <td>0.00</td>
                        <td onmouseover="setCustomerTooltip(this)" onclick="openModal()">1.00</td>
                    </tr>
                    <tr class="total-row">
                        <td></td>
                        <td class="left-align">Total ABC INDIA</td>
                        <td colspan="2"></td>
                        <td>170560.00</td>
                        <td>0.00</td>
                        <td></td>
                        <td></td>
                    </tr>

                    <!-- Final Totals -->
                    <tr class="total-row">
                        <td></td>
                        <td class="left-align">Total for the Period</td>
                        <td colspan="2"></td>
                        <td>215695.00</td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr class="total-row">
                        <td></td>
                        <td class="left-align">Collection upto @DateTime.Now.ToString("dd/MM/yy")</td>
                        <td colspan="2"></td>
                        <td>715695.00</td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal -->
<div id="acdModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h3>ACD Details</h3>
        <table>
            <thead>
                <tr>
                    <th>Bill No</th>
                    <th>Posting Date</th>
                    <th>Amount</th>
                    <th>Due Date</th>
                    <th>Recd Date</th>
                    <th>Recd Amt</th>
                    <th>Recd Days * Recd Amt</th>
                    <th>Days</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>1</td><td>25-08-2020</td><td>1000</td><td>24-09-2020</td><td>25-09-2020</td><td>600</td><td>18600</td><td>31</td></tr>
                <tr><td>1</td><td>25-08-2020</td><td>1000</td><td>24-09-2020</td><td>05-10-2020</td><td>400</td><td>16400</td><td>41</td></tr>
                <tr><td>2</td><td>01-09-2020</td><td>5000</td><td>31-10-2020</td><td>02-11-2020</td><td>5000</td><td>310000</td><td>62</td></tr>
                <tr><td>3</td><td>10-09-2020</td><td>3000</td><td>09-11-2020</td><td>22-11-2020</td><td>3000</td><td>219000</td><td>73</td></tr>
                <tr><td>4</td><td>15-09-2020</td><td>4000</td><td>15-10-2020</td><td>15-10-2020</td><td>3000</td><td>90000</td><td>30</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    function openModal() {
        document.getElementById('acdModal').style.display = 'block';
    }
    function closeModal() {
        document.getElementById('acdModal').style.display = 'none';
    }
    window.onclick = function (event) {
        const modal = document.getElementById('acdModal');
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    };

    function toggleDetails(element) {
        const icon = element.querySelector('i');
        const row = element.closest('tr');
        let next = row.nextElementSibling;
        const details = [];

        while (next && next.classList.contains('toggle-detail')) {
            details.push(next);
            next = next.nextElementSibling;
        }

        const isVisible = details[0].style.display !== 'none';
        details.forEach(r => r.style.display = isVisible ? 'none' : '');

        icon.classList.remove(isVisible ? 'bx-minus-circle' : 'bx-plus-circle');
        icon.classList.add(isVisible ? 'bx-plus-circle' : 'bx-minus-circle');
    }

    function setCustomerTooltip(cell) {
        let currentRow = cell.closest('tr');
        while (currentRow && !currentRow.classList.contains('customer-row')) {
            currentRow = currentRow.previousElementSibling;
        }
        let customerName = '';
        if (currentRow) {
            customerName = currentRow.querySelector('td.left-align')?.textContent?.trim() || '';
        }
        cell.title = customerName;
    }
</script>
}
